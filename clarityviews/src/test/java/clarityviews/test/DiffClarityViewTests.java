package clarityviews.test;

import static org.junit.Assert.assertTrue;

import org.apache.commons.lang3.StringUtils;
import org.junit.Test;

import com.clarity.binary.diagram.ClassDiagram;
import com.clarity.binary.diagram.DiffClarityView;
import com.clarity.binary.extractor.ClassRelationshipsExtractor;
import com.clarity.binary.parse.ParsedProject;
import com.clarity.sourcemodel.OOPSourceCodeModel;

public class DiffClarityViewTests {

    @Test
    public void ClarityViewSimpleDiffDiagramTest() throws Exception {
        OOPSourceCodeModel oldModel = new ParsedProject(
                ClarityTestUtil.parseRequestContentObjFromResourceDir("/codebaseA/")).model();
        OOPSourceCodeModel newModel = new ParsedProject(
                ClarityTestUtil.parseRequestContentObjFromResourceDir("/codebaseB/")).model();
        ClassDiagram view = new DiffClarityView(
                new ClassRelationshipsExtractor<Object>().generateBinaryClassRelationships(oldModel),
                new ClassRelationshipsExtractor<Object>().generateBinaryClassRelationships(newModel), oldModel,
                newModel, true).view();
        System.out.println((view).svgText());
        assertTrue(StringUtils.getLevenshteinDistance(view.svgText(),
                "<?xml version=\"1.0\" encoding=\"UTF-8\" standalone=\"yes\"?><svg xmlns=\"http://www.w3.org/2000/svg\" xmlns:xlink=\"http://www.w3.org/1999/xlink\" height=\"793px\" style=\"width:671px;height:793px;background:#1D1F21;\" version=\"1.1\" viewBox=\"0 0 671 793\" width=\"671px\"><defs/><g><polygon fill=\"#161719\" points=\"22,24,109,24,116,49,664,49,664,786,22,786,22,24\" style=\"stroke: #7E7E7E; stroke-width: 2.0;\"/><line style=\"stroke: #7E7E7E; stroke-width: 2.0;\" x1=\"22\" x2=\"116\" y1=\"49\" y2=\"49\"/><text fill=\"#7E7E7E\" font-family=\"Consolas\" font-size=\"16\" lengthAdjust=\"spacingAndGlyphs\" text-rendering=\"geometricPrecision\" x=\"26\" y=\"42\">codebaseA</text><rect fill=\"#1D1F21\" height=\"97\" style=\"stroke: #BBBBBB; stroke-width: 2.0;\" width=\"442\" x=\"38\" y=\"267\"/><ellipse cx=\"97\" cy=\"283\" fill=\"#ADD1B2\" rx=\"11\" ry=\"11\" style=\"stroke: #BBBBBB; stroke-width: 2.0;\"/><path d=\"M100,279 Q100,279 100,279 Q101,278 101,278 Q101,278 101,279 Q102,279 102,280 L102,281 Q102,282 101,282 Q101,282 101,282 Q100,282 100,282 Q100,282 100,281 Q100,281 100,281 Q99,280 99,280 Q98,280 98,280 Q97,280 96,280 Q95,281 95,281 Q94,282 94,283 L94,284 Q94,285 95,286 Q96,287 98,287 Q99,287 99,287 Q100,287 100,286 Q101,286 101,286 Q101,286 101,286 Q101,286 102,286 Q102,286 102,287 Q102,287 102,287 Q101,288 100,288 Q99,289 98,289 Q96,289 95,288 Q94,288 93,287 Q93,285 93,284 L93,283 Q93,282 93,281 Q94,279 95,279 Q96,278 97,278 Q98,278 99,278 Q99,279 100,279 Z \"/><text class=\"interactiveComponent\" fill=\"#C5C8C6\" font-family=\"Consolas\" font-size=\"16\" id=\"codebaseA.JavaDocSymbolStrippedText\" lengthAdjust=\"spacingAndGlyphs\" onclick=\"classElementCallBack('codebaseA.JavaDocSymbolStrippedText')\" text-rendering=\"geometricPrecision\" x=\"118\" y=\"290\">JavaDocSymbolStrippedText</text><line style=\"stroke: #BBBBBB; stroke-width: 2.0;\" x1=\"39\" x2=\"479\" y1=\"299\" y2=\"299\"/><rect fill=\"none\" height=\"6\" style=\"stroke: #C82930; stroke-width: 2.0;\" width=\"6\" x=\"46\" y=\"310\"/><text fill=\"#F97D7D\" font-family=\"Consolas\" font-size=\"14\" id=\"codebaseA.JavaDocSymbolStrippedText.text\" lengthAdjust=\"spacingAndGlyphs\" text-rendering=\"geometricPrecision\" x=\"58\" y=\"317\">text : Text</text><line style=\"stroke: #BBBBBB; stroke-width: 2.0;\" x1=\"39\" x2=\"479\" y1=\"323\" y2=\"323\"/><ellipse cx=\"49\" cy=\"337\" fill=\"#84BE84\" rx=\"3\" ry=\"3\" style=\"stroke: #038048; stroke-width: 2.0;\"/><text class=\"interactiveComponent\" fill=\"#C5C8C6\" font-family=\"Consolas\" font-size=\"14\" id=\"codebaseA.JavaDocSymbolStrippedText.value()\" lengthAdjust=\"spacingAndGlyphs\" onclick=\"classElementCallBack('codebaseA.JavaDocSymbolStrippedText.value()')\" text-rendering=\"geometricPrecision\" x=\"58\" y=\"341\">value() : String</text><ellipse cx=\"49\" cy=\"353\" fill=\"#84BE84\" rx=\"3\" ry=\"3\" style=\"stroke: #038048; stroke-width: 2.0;\"/><text class=\"interactiveComponent\" fill=\"#C5C8C6\" font-family=\"Consolas\" font-size=\"14\" id=\"codebaseA.JavaDocSymbolStrippedText.color()\" lengthAdjust=\"spacingAndGlyphs\" onclick=\"classElementCallBack('codebaseA.JavaDocSymbolStrippedText.color()')\" text-rendering=\"geometricPrecision\" x=\"58\" y=\"358\">color() : String</text><rect fill=\"#1D1F21\" height=\"81\" style=\"stroke: #BBBBBB; stroke-width: 2.0;\" width=\"402\" x=\"246\" y=\"532\"/><ellipse cx=\"330\" cy=\"548\" fill=\"#B4A7E5\" rx=\"11\" ry=\"11\" style=\"stroke: #BBBBBB; stroke-width: 2.0;\"/><path d=\"M331,545 L331,551 L333,551 Q334,551 334,552 Q334,552 334,552 Q334,553 334,553 Q334,553 333,553 L328,553 Q327,553 327,553 Q327,553 327,552 Q327,552 327,552 Q327,551 328,551 L330,551 L330,545 L328,545 Q327,545 327,544 Q327,544 327,544 Q327,543 327,543 Q327,543 328,543 L333,543 Q334,543 334,543 Q334,543 334,544 Q334,544 334,544 Q334,545 333,545 L331,545 Z \"/><text class=\"interactiveComponent\" fill=\"#F97D7D\" font-family=\"Consolas\" font-size=\"16\" font-style=\"italic\" id=\"codebaseA.DefaultTextUser\" lengthAdjust=\"spacingAndGlyphs\" onclick=\"classElementCallBack('codebaseA.DefaultTextUser')\" text-rendering=\"geometricPrecision\" x=\"351\" y=\"555\">DefaultTextUser</text><line style=\"stroke: #BBBBBB; stroke-width: 2.0;\" x1=\"247\" x2=\"647\" y1=\"564\" y2=\"564\"/><text fill=\"#f97d7d\" font-family=\"Consolas\" font-size=\"14\" lengthAdjust=\"spacingAndGlyphs\" text-rendering=\"geometricPrecision\" x=\"252\" y=\"582\">An abstract class comment ...</text><line style=\"stroke: #BBBBBB; stroke-width: 2.0;\" x1=\"247\" x2=\"647\" y1=\"588\" y2=\"588\"/><rect fill=\"#F24D5C\" height=\"6\" style=\"stroke: #C82930; stroke-width: 2.0;\" width=\"6\" x=\"254\" y=\"599\"/><text class=\"interactiveComponent\" fill=\"#F97D7D\" font-family=\"Consolas\" font-size=\"14\" id=\"codebaseA.DefaultTextUser.strawberry()\" lengthAdjust=\"spacingAndGlyphs\" onclick=\"classElementCallBack('codebaseA.DefaultTextUser.strawberry()')\" text-rendering=\"geometricPrecision\" x=\"266\" y=\"606\">strawberry() : String</text><rect fill=\"#1D1F21\" height=\"48\" style=\"stroke: #BBBBBB; stroke-width: 2.0;\" width=\"230\" x=\"38\" y=\"424\"/><ellipse cx=\"53\" cy=\"440\" fill=\"#A9DCDF\" rx=\"11\" ry=\"11\" style=\"stroke: #BBBBBB; stroke-width: 2.0;\"/><path d=\"M55,442 L51,442 L51,443 L51,443 Q52,443 52,443 Q52,443 52,444 Q52,444 52,444 Q52,445 51,445 L49,445 Q48,445 48,444 Q48,444 48,444 Q48,443 48,443 Q48,443 49,443 L51,436 L50,436 Q50,436 49,436 Q49,436 49,435 Q49,435 49,435 Q50,434 50,434 L54,434 L57,443 Q58,443 58,443 Q59,443 59,444 Q59,444 58,444 Q58,445 57,445 L55,445 Q55,445 54,444 Q54,444 54,444 Q54,443 54,443 Q55,443 55,443 L56,443 L55,442 Z M54,440 L53,437 L52,440 L54,440 Z \"/><text class=\"interactiveComponent\" fill=\"#22df80\" font-family=\"Consolas\" font-size=\"16\" font-style=\"italic\" id=\"codebaseA.NewTextClass\" lengthAdjust=\"spacingAndGlyphs\" onclick=\"classElementCallBack('codebaseA.NewTextClass')\" text-rendering=\"geometricPrecision\" x=\"67\" y=\"447\">NewTextClass</text><line style=\"stroke: #BBBBBB; stroke-width: 2.0;\" x1=\"39\" x2=\"267\" y1=\"456\" y2=\"456\"/><line style=\"stroke: #BBBBBB; stroke-width: 2.0;\" x1=\"39\" x2=\"267\" y1=\"464\" y2=\"464\"/><rect fill=\"#1D1F21\" height=\"146\" style=\"stroke: #BBBBBB; stroke-width: 2.0;\" width=\"610\" x=\"38\" y=\"61\"/><ellipse cx=\"204\" cy=\"77\" fill=\"#ADD1B2\" rx=\"11\" ry=\"11\" style=\"stroke: #BBBBBB; stroke-width: 2.0;\"/><path d=\"M207,73 Q207,73 207,73 Q207,72 207,72 Q208,72 208,73 Q208,73 208,74 L208,75 Q208,76 208,76 Q208,76 207,76 Q207,76 207,76 Q207,76 206,75 Q206,75 206,75 Q206,74 205,74 Q205,74 204,74 Q203,74 203,74 Q202,75 201,75 Q201,76 201,77 L201,78 Q201,79 202,80 Q203,81 204,81 Q205,81 206,81 Q206,81 207,80 Q207,80 207,80 Q207,80 208,80 Q208,80 208,80 Q208,80 208,81 Q208,81 208,81 Q208,82 207,82 Q206,83 204,83 Q203,83 202,82 Q201,82 200,81 Q199,79 199,78 L199,77 Q199,76 200,75 Q201,73 202,73 Q203,72 204,72 Q205,72 205,72 Q206,73 207,73 Z \"/><text class=\"interactiveComponent\" fill=\"#C5C8C6\" font-family=\"Consolas\" font-size=\"16\" id=\"codebaseA.HtmlTagsStrippedText\" lengthAdjust=\"spacingAndGlyphs\" onclick=\"classElementCallBack('codebaseA.HtmlTagsStrippedText')\" text-rendering=\"geometricPrecision\" x=\"224\" y=\"84\">HtmlTagsStrippedText</text><line style=\"stroke: #BBBBBB; stroke-width: 2.0;\" x1=\"39\" x2=\"647\" y1=\"93\" y2=\"93\"/><rect fill=\"none\" height=\"6\" style=\"stroke: #C82930; stroke-width: 2.0;\" width=\"6\" x=\"46\" y=\"104\"/><text fill=\"#C5C8C6\" font-family=\"Consolas\" font-size=\"14\" id=\"codebaseA.HtmlTagsStrippedText.var\" lengthAdjust=\"spacingAndGlyphs\" text-rendering=\"geometricPrecision\" x=\"58\" y=\"111\">var : ArrayList&lt;JavaDocSymbolStrippedText&gt;</text><rect fill=\"none\" height=\"6\" style=\"stroke: #C82930; stroke-width: 2.0;\" width=\"6\" x=\"46\" y=\"120\"/><text fill=\"#C5C8C6\" font-family=\"Consolas\" font-size=\"14\" id=\"codebaseA.HtmlTagsStrippedText.text\" lengthAdjust=\"spacingAndGlyphs\" text-rendering=\"geometricPrecision\" x=\"58\" y=\"127\">text : Text</text><polygon fill=\"none\" points=\"49,135,45,141,53,141\" style=\"stroke: #1963A0; stroke-width: 2.0;\"/><text fill=\"#C5C8C6\" font-family=\"Consolas\" font-size=\"14\" id=\"codebaseA.HtmlTagsStrippedText.settings\" lengthAdjust=\"spacingAndGlyphs\" text-rendering=\"geometricPrecision\" x=\"58\" y=\"144\">settings : OutputSettings</text><line style=\"stroke: #BBBBBB; stroke-width: 2.0;\" x1=\"39\" x2=\"647\" y1=\"150\" y2=\"150\"/><ellipse cx=\"49\" cy=\"164\" fill=\"#84BE84\" rx=\"3\" ry=\"3\" style=\"stroke: #038048; stroke-width: 2.0;\"/><text class=\"interactiveComponent\" fill=\"#C5C8C6\" font-family=\"Consolas\" font-size=\"14\" id=\"codebaseA.HtmlTagsStrippedText.value()\" lengthAdjust=\"spacingAndGlyphs\" onclick=\"classElementCallBack('codebaseA.HtmlTagsStrippedText.value()')\" text-rendering=\"geometricPrecision\" x=\"58\" y=\"168\">value() : String</text><ellipse cx=\"49\" cy=\"180\" fill=\"#84BE84\" rx=\"3\" ry=\"3\" style=\"stroke: #038048; stroke-width: 2.0;\"/><text class=\"interactiveComponent\" fill=\"#C5C8C6\" font-family=\"Consolas\" font-size=\"14\" id=\"codebaseA.HtmlTagsStrippedText.color()\" lengthAdjust=\"spacingAndGlyphs\" onclick=\"classElementCallBack('codebaseA.HtmlTagsStrippedText.color()')\" text-rendering=\"geometricPrecision\" x=\"58\" y=\"185\">color() : String</text><ellipse cx=\"49\" cy=\"197\" fill=\"#84BE84\" rx=\"3\" ry=\"3\" style=\"stroke: #038048; stroke-width: 2.0;\"/><text class=\"interactiveComponent\" fill=\"#22df80\" font-family=\"Consolas\" font-size=\"14\" id=\"codebaseA.HtmlTagsStrippedText.newMethod()\" lengthAdjust=\"spacingAndGlyphs\" onclick=\"classElementCallBack('codebaseA.HtmlTagsStrippedText.newMethod()')\" text-rendering=\"geometricPrecision\" x=\"58\" y=\"201\">newMethod() : String</text><rect fill=\"#1D1F21\" height=\"97\" style=\"stroke: #BBBBBB; stroke-width: 2.0;\" width=\"388\" x=\"38\" y=\"673\"/><ellipse cx=\"165\" cy=\"689\" fill=\"#B4A7E5\" rx=\"11\" ry=\"11\" style=\"stroke: #BBBBBB; stroke-width: 2.0;\"/><path d=\"M166,686 L166,692 L167,692 Q168,692 168,693 Q169,693 169,693 Q169,694 168,694 Q168,694 167,694 L162,694 Q162,694 161,694 Q161,694 161,693 Q161,693 161,693 Q162,692 162,692 L164,692 L164,686 L162,686 Q162,686 161,685 Q161,685 161,685 Q161,684 161,684 Q162,684 162,684 L167,684 Q168,684 168,684 Q169,684 169,685 Q169,685 168,685 Q168,686 167,686 L166,686 Z \"/><text class=\"interactiveComponent\" fill=\"#C5C8C6\" font-family=\"Consolas\" font-size=\"16\" font-style=\"italic\" id=\"codebaseA.Text\" lengthAdjust=\"spacingAndGlyphs\" onclick=\"classElementCallBack('codebaseA.Text')\" text-rendering=\"geometricPrecision\" x=\"185\" y=\"696\">Text</text><line style=\"stroke: #BBBBBB; stroke-width: 2.0;\" x1=\"39\" x2=\"425\" y1=\"705\" y2=\"705\"/><text fill=\"#C5C8C6\" font-family=\"Consolas\" font-size=\"14\" lengthAdjust=\"spacingAndGlyphs\" text-rendering=\"geometricPrecision\" x=\"44\" y=\"723\">A comment for ze diagram.  @author zir0-93  ...</text><line style=\"stroke: #BBBBBB; stroke-width: 2.0;\" x1=\"39\" x2=\"425\" y1=\"729\" y2=\"729\"/><polygon fill=\"#4177AF\" points=\"49,739,45,745,53,745\" style=\"stroke: #1963A0; stroke-width: 2.0;\"/><text class=\"interactiveComponent\" fill=\"#C5C8C6\" font-family=\"Consolas\" font-size=\"14\" id=\"codebaseA.Text.value()\" lengthAdjust=\"spacingAndGlyphs\" onclick=\"classElementCallBack('codebaseA.Text.value()')\" text-rendering=\"geometricPrecision\" x=\"58\" y=\"747\">value() : String</text><polygon fill=\"#4177AF\" points=\"49,755,45,761,53,761\" style=\"stroke: #1963A0; stroke-width: 2.0;\"/><text class=\"interactiveComponent\" fill=\"#C5C8C6\" font-family=\"Consolas\" font-size=\"14\" id=\"codebaseA.Text.color()\" lengthAdjust=\"spacingAndGlyphs\" onclick=\"classElementCallBack('codebaseA.Text.color()')\" text-rendering=\"geometricPrecision\" x=\"58\" y=\"764\">color() : String</text><path d=\"M220,364 C208,379 196,394 185,408 \" fill=\"none\" style=\"stroke: #22DF80; stroke-width: 2.0;\"/><polygon fill=\"none\" points=\"190,413,172,424,179,404,190,413\" style=\"stroke: #22DF80; stroke-width: 2.0;\"/><path d=\"M453,207 C471,224 488,245 498,267 C516,306 519,326 498,364 C464,426 262,470 228,532 C208,568 209,615 215,653 \" fill=\"none\" style=\"stroke: #C5C8C6; stroke-width: 2.0; stroke-dasharray: 7.0,7.0;\"/><polygon fill=\"none\" points=\"222,652,218,673,208,654,222,652\" style=\"stroke: #C5C8C6; stroke-width: 2.0;\"/><path d=\"M297,207 C289,223 281,239 275,254 \" fill=\"none\" style=\"stroke: #22DF80; stroke-width: 2.0;\"/><polygon fill=\"#22DF80\" points=\"270,267,276,263,274,256,268,260,270,267\" style=\"stroke: #22DF80; stroke-width: 2.0;\"/><text fill=\"#C5C8C6\" font-family=\"Consolas\" font-size=\"16\" lengthAdjust=\"spacingAndGlyphs\" text-rendering=\"geometricPrecision\" x=\"254\" y=\"231\">0..*</text><path d=\"M322,207 C315,223 308,240 300,255 \" fill=\"none\" style=\"stroke: #F97D7D; stroke-width: 2.0;\"/><polygon fill=\"#FFFFFF\" points=\"293,267,300,263,299,256,293,260,293,267\" style=\"stroke: #F97D7D; stroke-width: 2.0;\"/><path d=\"M282,364 C293,396 302,439 285,472 C264,513 222,491 201,532 C185,564 196,577 201,613 C203,626 206,640 210,653 \" fill=\"none\" style=\"stroke: #C5C8C6; stroke-width: 2.0; stroke-dasharray: 7.0,7.0;\"/><polygon fill=\"none\" points=\"216,652,215,673,203,656,216,652\" style=\"stroke: #C5C8C6; stroke-width: 2.0;\"/><path d=\"M389,613 C367,628 342,645 318,662 \" fill=\"none\" style=\"stroke: #F97D7D; stroke-width: 2.0;\"/><polygon fill=\"none\" points=\"322,667,301,673,314,656,322,667\" style=\"stroke: #F97D7D; stroke-width: 2.0;\"/><path d=\"M151,472 C149,505 148,565 164,613 C169,628 176,642 184,656 \" fill=\"none\" style=\"stroke: #22DF80; stroke-width: 2.0; stroke-dasharray: 7.0,7.0;\"/><polygon fill=\"none\" points=\"190,652,195,673,178,660,190,652\" style=\"stroke: #22DF80; stroke-width: 2.0;\"/></g></svg>") < 3);
    }
}
